<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatClient – Discord-like P2P Chat</title>
    <script>
      // Pre-apply theme tokens before React mounts to avoid a white flash/blank look
      (function () {
        try {
          var root = document.documentElement;
          var storedTheme = localStorage.getItem('chatclient.theme');
          var theme = storedTheme === 'dark' || storedTheme === 'light' ? storedTheme : 'light';
          var accent = localStorage.getItem('chatclient.accent') || '#6366f1';
          root.dataset.theme = theme;
          // Light/dark palettes — keep in sync with ThemeContext.tsx
          var palettes = {
            light: {
              '--bg': '#f4f6fb',
              '--surface': '#ffffff',
              '--surface-alt': '#f8fafc',
              '--sidebar': '#ffffff',
              '--sidebar-accent': '#f1f5f9',
              '--border': 'rgba(148, 163, 184, 0.25)',
              '--border-strong': 'rgba(148, 163, 184, 0.35)',
              '--text-primary': '#0f172a',
              '--text-secondary': '#475569',
              '--text-inverse': '#f8fafc',
              '--shadow': '0 24px 48px rgba(15, 23, 42, 0.12)',
              '--scrollbar': 'rgba(148, 163, 184, 0.45)',
              '--scrollbar-hover': 'rgba(100, 116, 139, 0.7)'
            },
            dark: {
              '--bg': '#0d1423',
              '--surface': '#131a2b',
              '--surface-alt': '#171f33',
              '--sidebar': '#0a101d',
              '--sidebar-accent': '#131a2b',
              '--border': 'rgba(148, 163, 184, 0.18)',
              '--border-strong': 'rgba(148, 163, 184, 0.32)',
              '--text-primary': '#e2e8f0',
              '--text-secondary': '#94a3b8',
              '--text-inverse': '#0f172a',
              '--shadow': '0 32px 64px rgba(2, 6, 23, 0.55)',
              '--scrollbar': 'rgba(148, 163, 184, 0.35)',
              '--scrollbar-hover': 'rgba(148, 163, 184, 0.6)'
            }
          };
          var accentHex = /^#?[0-9a-fA-F]{3,6}$/.test(accent) ? (accent.startsWith('#') ? accent : '#' + accent) : '#6366f1';
          function hexToRgb(hex) {
            var n = hex.replace('#', '');
            n = n.length === 3 ? n.split('').map(function (c) { return c + c; }).join('') : n.padEnd(6, '0');
            var int = parseInt(n, 16) || 0;
            return { r: (int >> 16) & 255, g: (int >> 8) & 255, b: int & 255 };
          }
          function mix(a, b, t) {
            var A = hexToRgb(a), B = hexToRgb(b);
            function toHex(v) { return Math.min(255, Math.max(0, Math.round(v))).toString(16).padStart(2, '0'); }
            var r = A.r + (B.r - A.r) * t, g = A.g + (B.g - A.g) * t, b = A.b + (B.b - A.b) * t;
            return '#' + toHex(r) + toHex(g) + toHex(b);
          }
          function rgba(hex, a) {
            var c = hexToRgb(hex);
            return 'rgba(' + c.r + ', ' + c.g + ', ' + c.b + ', ' + a + ')';
          }
          function contrast(hex) {
            var c = hexToRgb(hex);
            var L = (0.299 * c.r + 0.587 * c.g + 0.114 * c.b) / 255;
            return L > 0.6 ? '#0f172a' : '#f8fafc';
          }
          var tokens = Object.assign({}, palettes[theme], {
            '--accent': accentHex,
            '--accent-soft': mix(accentHex, '#ffffff', 0.78),
            '--accent-strong': mix(accentHex, '#000000', 0.2),
            '--accent-ring': mix(accentHex, '#000000', 0.35),
            '--accent-glow': rgba(accentHex, 0.25),
            '--accent-contrast': contrast(accentHex)
          });
          Object.keys(tokens).forEach(function (k) { root.style.setProperty(k, tokens[k]); });
          root.style.setProperty('color-scheme', theme);
        } catch (_) {
          // ignore
        }
      })();
    </script>
    <script>
      // Ensure Node-like global exists for libs that expect it (e.g., simple-peer)
      (function () {
        if (typeof window !== 'undefined' && typeof window.global === 'undefined') {
          // @ts-ignore - this is plain JS
          window.global = window;
        }
      })();
    </script>
  </head>
  <body>
    <div id="root">
      <noscript>
        <div style="padding:16px;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;">
          ChatClient requires JavaScript to run.
        </div>
      </noscript>
      <div style="display:flex;align-items:center;justify-content:center;height:100vh;color:var(--text-primary);background:var(--bg);">
        <div style="opacity:0.7">Loading ChatClient…</div>
      </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
